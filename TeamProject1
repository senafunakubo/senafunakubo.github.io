//
//  main.c
//  new_project1
//
//  Created by Sena Funakubo on 2017-02-03.
//  Copyright © 2017 Sena Funakubo. All rights reserved.
//

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define MAXCNT 10
#define N 8

//int checkLogin(char studentId[30], char password[30]);
void showMenu(void);
void showMenuOptions(void);
char* substring(char* info);
void readFile(char* fileName);

struct accounts
{
    int studentId;
    char* password;
};

struct student
{
    int idNumber;
    char* firstName;
    char* lastName;
    char* gender;
    int grade;
    char* address;
    int addmissionYear;
    char* courses;
};

struct studentGrade
{
    int* idNumber;
    char* courseId;
    int mark;
};

struct courseDetail
{
    char* courseId;
    char* courseName;
};

int main(int argc, char* argv[])
{
      char *fileNameAccount="/Users/senafunakubo/Documents/new_project1/new_project1/project_Accounts.txt";
      char *fileNameStudents="/Users/senafunakubo/Documents/new_project1/new_project1/Students.txt";
//    char *fileNameStCourses="/Users/senafunakubo/Documents/new_project1/new_project1/StudentsCourses.txt";
//    char *fileNameCourses="/Users/senafunakubo/Documents/new_project1/new_project1/Courses.txt";

      readFile(fileNameAccount);
      readFile(fileNameStudents);
//    readFile(fileNameStCourses);
//    readFile(fileNameCourses);

    char studentId[30], password[30];

    printf("*********************************************************\n");
    printf(" Please enter your account to login:\n");
    printf("*********************************************************\n");
    printf("\nUserID:");
    scanf("%s",studentId);
    printf("\nPassword:");
    scanf("%s",password);

//    checkLogin(studentId, password);

    showMenu();

    return 0;
}

void readFile(char* fileName){
    FILE *fp;
    int i;
    char studentData[256];
    char* result;
//    struct accounts data[MAXCNT];

    if ((fp = fopen( fileName, "r" )) == NULL){
        printf("file open error!!\n");
    }

    while (fgets(studentData,sizeof(studentData), fp)!=NULL){
        printf("%s",studentData);

        if(studentData[0]!='\n'){
        result = substring(studentData);
        printf("[result]%s",result);
        }
        printf("\n\n");

        //Try to put the data to struct...
//        sscanf(studentData,"%d",&data[i].studentId);
//        printf("list[%d]:\n\tID:%d\n\t",i,data[i].studentId);
        i++;
    }
        fclose(fp);
}

//(e.g.)When you get "studentID:”7813007”\n" from Accounts.txt
char* substring(char* info)//info is "studentID:”7813007”\n"
{
    int counter1 = 0;
    int length1 = 0;
    int counter2 = 0;
    int length2 = 0;
    //    int endIndex = length
    while (counter1<1) {//get a string of length before ID starts
        if(info[length1]=='\x9d')//count till first '\x9d' to get the length
        {
            counter1++;
        }
        length1++;
    }
    while (counter2<2) {//get a string of length when ID is done
        if(info[length2]=='\xe2')//then count before 2nd '\xe2' to get the length
        {
            counter2++;
        }
        length2++;
    }
    int count = 0;
    char* result = (char*) malloc(length2 * sizeof(char));//allocates memory of length
    for(int i = length1; i < length2-1; i++)
    {
        result[count] = info[i];//copy 7813007 from "studentID:”7813007”\n"
        count++;
    }
    return result;//return 7813007
}

//int checkLogin(char studentId[30], char password[30]){
//    FILE *p;
//    char studentId2[30];
//    char password2[30];
//       p= fopen("/Users/senafunakubo/Documents/new_project1/new_project1/project_Accounts.txt", "r");
//
//    fscanf(p,"User: %s Password: %s",studentId2,password2);
//    if( (strcmp(studentId,studentId2)==0) && (strcmp(password,password2)==0) ){
//        printf("\nUser and password are correct!!!");
//    }else{
//        printf("\nUser or password is incorrect!\n\n");
//    }
//    printf("\n\n");
//
//    fclose(p);
//    return 0;
//}
//

void showMenu(void)
{
    showMenuOptions();

    int input;
    printf("Enter the number corresponding to each item to proceed: ");
    scanf("%d", &input);

    while (input!=9) {

        if(input==1)
        {
            printf("[1] Print my enrolment certificate\n");
            printf("Dear\n");
            break;
        }
        else if(input==2)
        {
//[2] Print my courses
        }
        else if(input==3)
        {
//[3] Print my transcript
        }
        else if(input==4)
        {
//[4] Print my GPA
        }
        else if(input==5)
        {
//[5] Print my ranking among all studentsin the college
        }
        else if(input==6)
        {
            printf("[6] List all available courses\n");
            break;
        }
        else if(input==7)
        {
//[7] List all students
        }
        else if(input==8)
        {
//[8] Logout
        }

//        showMenuOptions();
//        scanf("%d", &input);

    }//end of while
    printf("\n*********************************************\n");
}

void showMenuOptions(void)
{
    printf("\n*********************************************************\n");
    printf(" Select from the options:");
    printf("\n*********************************************************\n");

    printf("[1] Print my enrolment certificate\n");
    printf("[2] Print my courses\n");
    printf("[3] Print my transcript\n");
    printf("[4] Print my GPA\n");
    printf("[5] Print my ranking among all studentsin the college\n");
    printf("[6] List all available courses\n");
    printf("[7] List all students\n");
    printf("[8] Logout\n");
    printf("[9] Exit\n");

    printf("\n==============================\n");
}
